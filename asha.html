<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASHA Worker — Report Water Quality</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root{--bg:#f7f9fc;--card:#ffffff;--muted:#6b7280;--accent-1:#0ea5a4;--accent-2:#6366f1;--radius:12px;--shadow-sm:0 6px 18px rgba(16,24,40,0.06);--shadow-md:0 12px 30px rgba(16,24,40,0.08);font-family:"Inter",system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;color-scheme:light}
        *{box-sizing:border-box}
        html,body{height:100%;margin:0;background:linear-gradient(180deg,#f7fbfb 0%,var(--bg) 100%);font-size:16px;color:#0f172a}
        a{color:inherit;text-decoration:none}
        header{display:flex;align-items:center;justify-content:space-between;padding:14px 28px;background:linear-gradient(90deg,var(--accent-1),var(--accent-2));color:white;border-radius:0 0 var(--radius) var(--radius);box-shadow:var(--shadow-md)}
        .brand{display:flex;gap:12px;align-items:center;font-weight:700;font-size:20px}
        nav ul{display:flex;gap:16px;list-style:none}
        nav ul li a{color:white;font-weight:500}
        main{max-width:900px;margin:28px auto;padding:0 16px}
        h1{font-size:28px;margin-bottom:12px}
        p.sub{color:var(--muted);margin-bottom:24px}
        .card{background:var(--card);padding:24px;border-radius:var(--radius);box-shadow:var(--shadow-md);display:flex;flex-direction:column;gap:16px}
        .card h2{margin:0;color:var(--accent-1)}
        .form-row{display:flex;gap:16px;flex-wrap:wrap}
        .field{display:flex;flex-direction:column;gap:6px;flex:1;min-width:140px}
        .field input,.field select,.field textarea{padding:10px 12px;border-radius:8px;border:1px solid #e6e9ef;background:white;font-size:14px}
        .field textarea{resize:vertical}
        .checkbox-group{display:flex;flex-wrap:wrap;gap:12px;margin-top:6px}
        .checkbox-group label{display:flex;align-items:center;gap:6px;font-size:14px}
        button{padding:10px 16px;border-radius:10px;border:0;cursor:pointer;font-weight:600;color:white;background:linear-gradient(90deg,var(--accent-1),var(--accent-2));box-shadow:var(--shadow-sm)}
        #result-container{margin-top:16px;padding:12px;border-radius:8px;background:#e6f0fa;color:#0f172a;display:none}
        .status-safe { background: #dcfce7; color: #166534; padding: 4px 8px; border-radius: 4px; }
        .status-unsafe { background: #fee2e2; color: #991b1b; padding: 4px 8px; border-radius: 4px; }
        footer{text-align:center;color:var(--muted);padding:24px 0;font-size:14px;margin-top:40px}
        @media (max-width:600px){header{flex-direction:column;gap:12px;text-align:center}.form-row{flex-direction:column}}
    </style>
</head>
<body>
    <header>
        <div class="brand">CleanWater — ASHA Worker</div>
        <nav>
            <ul>
                <li><a href="home.html">Home</a></li>
                <li><a href="#">Logout</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <div class="card">
            <h2>Submit Water Quality Report</h2>
            <p class="sub">This comprehensive at-home testing kit provides essential water quality measurements. Your reports will be sent directly to health officials for prompt action.</p>
            
            <form id="reportForm">
                <div class="form-row">
                    <div class="field">
                        <label for="village">Village Name</label>
                        <input type="text" id="village" name="villageName" placeholder="Enter village name" required>
                    </div>
                    <div class="field">
                        <label for="sourceId">Water Source ID</label>
                        <input type="text" id="sourceId" name="waterSourceId" placeholder="e.g., WS-123" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="field">
                        <label for="date">Report Date</label>
                        <input type="date" id="date" name="reportDate" required>
                    </div>
                    <div class="field">
                        <label for="bacteria">Bacterial Level (CFU/ml)</label>
                        <input type="number" id="bacteria" name="bacterialLevel" placeholder="e.g., 200" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="field">
                        <label for="ph">pH Level</label>
                        <input type="number" step="0.1" id="ph" name="phLevel" placeholder="e.g., 7.2" required>
                    </div>
                    <div class="field">
                        <label for="turbidity">Turbidity (NTU)</label>
                        <input type="number" step="0.1" id="turbidity" name="turbidityNtu" placeholder="e.g., 1.5" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="field">
                        <label>Symptoms Observed</label>
                        <div class="checkbox-group">
                            <label><input type="checkbox" name="symptoms" value="Fever"> Fever</label>
                            <label><input type="checkbox" name="symptoms" value="Cold"> Cold</label>
                            <label><input type="checkbox" name="symptoms" value="Cough"> Cough</label>
                            <label><input type="checkbox" name="symptoms" value="Diarrhea"> Diarrhea</label>
                            <label><input type="checkbox" name="symptoms" value="Vomiting"> Vomiting</label>
                        </div>
                    </div>
                </div>

                <div class="field">
                    <label for="remarks">Remarks</label>
                    <textarea id="remarks" name="remarks" rows="3" placeholder="Add any additional info..."></textarea>
                </div>

                <button type="submit">Submit Report</button>
            </form>

            <div id="result-container">
                <p id="quality-result"></p>
                <p id="sms-status"></p>
                <p id="disease-result"></p>
            </div>
        </div>
    </main>

    <footer>© 2025 CleanWater. Report responsibly.</footer>

    <script>
        const form = document.getElementById('reportForm');
        const resultContainer = document.getElementById('result-container');
        const qualityResult = document.getElementById('quality-result');
        const smsStatus = document.getElementById('sms-status');
        const diseaseResult = document.getElementById('disease-result');

        form.addEventListener('submit', async (event) => {
            event.preventDefault();

            const symptoms = [];
            document.querySelectorAll('input[name="symptoms"]:checked').forEach((checkbox) => {
                symptoms.push(checkbox.value);
            });

            const formData = {
                villageName: document.getElementById('village').value,
                waterSourceId: document.getElementById('sourceId').value,
                reportDate: document.getElementById('date').value,
                bacterialLevel: parseFloat(document.getElementById('bacteria').value),
                phLevel: parseFloat(document.getElementById('ph').value),
                turbidityNtu: parseFloat(document.getElementById('turbidity').value),
                symptomsObserved: symptoms.join(', '),
                remarks: document.getElementById('remarks').value,
            };

            try {
                const response = await fetch('http://127.0.0.1:5000/submit-report', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData),
                });
                
                const result = await response.json();

                if (response.ok) {
                    resultContainer.style.display = 'block';
                    if (result.quality_category) {
                        qualityResult.textContent = `Water Quality: ${result.quality_category}`;
                        qualityResult.className = result.quality_category === 'Safe' ? 'status-safe' : 'status-unsafe';
                    }
                    if (result.sms_status) {
                        smsStatus.textContent = `SMS Status: ${result.sms_status}`;
                    }
                    if (result.diseases) {
                        diseaseResult.textContent = `Possible Diseases: ${result.diseases.join(', ')}`;
                    }
                    alert('Success: ' + result.message);
                    form.reset();
                } else {
                    alert('Error: ' + result.message);
                }
            } catch (error) {
                console.error('Submission failed:', error);
                alert('An error occurred. Could not connect to the server.');
                resultContainer.style.display = 'none';
            }
        });
    </script>
</body>

</html>
