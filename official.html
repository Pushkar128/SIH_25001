<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Health Officials - Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet.heat/dist/leaflet-heat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
  <style>
    :root {
      --bg: linear-gradient(180deg,#f0faff,#e0f7fa);
      --card: #ffffff;
      --muted: #4b5563;
      --accent-1: #16a34a;
      --accent-2: #2563eb;
      --accent-3: #ef4444;
      --accent-4: #f59e0b;
      --radius: 16px;
      --shadow-sm: 0 8px 24px rgba(0,0,0,0.08);
      --shadow-md: 0 16px 40px rgba(0,0,0,0.12);
      font-family: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box;margin:0;padding:0;}
    html,body{height:100%;background:var(--bg);font-size:16px;color:#0f172a;scroll-behavior:smooth;}
    a{text-decoration:none;color:inherit;transition:0.2s;}
    a:hover{color:var(--accent-2);}
    header{display:flex;justify-content:space-between;align-items:center;padding:18px 28px;background:linear-gradient(90deg,var(--accent-1),var(--accent-2));color:white;border-radius:0 0 var(--radius) var(--radius);box-shadow:var(--shadow-md);flex-wrap:wrap;}
    .brand{display:flex;gap:16px;align-items:center;font-weight:700;font-size:20px;}
    .logo-placeholder{width:56px;height:56px;background:linear-gradient(135deg,var(--accent-2),var(--accent-1));display:flex;align-items:center;justify-content:center;font-weight:700;border-radius:12px;color:white;font-size:18px;box-shadow:0 4px 12px rgba(0,0,0,0.15);}
    nav.dashboard-nav{margin-top:16px;background:white;padding:12px 20px;border-radius:12px;display:flex;gap:24px;justify-content:center;box-shadow:var(--shadow-sm);}
    nav.dashboard-nav a{text-decoration:none;color:#0f172a;font-weight:600;padding:6px 12px;border-radius:8px;transition:0.2s;}
    nav.dashboard-nav a:hover{background:rgba(37,99,235,0.1);color:var(--accent-2);}
    main{max-width:1100px;margin:32px auto;padding:0 16px;}
    h1{font-size:28px;margin-bottom:16px;display:inline-block;padding:4px 8px;background:white;border-radius:8px;background-clip:text;-webkit-background-clip:text;-webkit-text-fill-color:transparent;background:linear-gradient(90deg,var(--accent-1),var(--accent-2));}
    p.sub{color:var(--muted);margin-bottom:24px;}
    .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:18px;margin-bottom:24px;}
    .card{background:var(--card);padding:24px;border-radius:var(--radius);box-shadow:var(--shadow-md);transition:transform 0.3s,box-shadow 0.3s;}
    .card:hover{transform:translateY(-4px);box-shadow:0 24px 60px rgba(0,0,0,0.18);}
    .card h2, .card h3{margin-bottom:12px;color:var(--accent-1);}
    #map{height:350px;border-radius:12px;}
    table{width:100%;border-collapse:collapse;}
    th,td{padding:10px;text-align:left;border-bottom:1px solid #e5e7eb;}
    th{background:#f9fafb;}
    tr:hover{background:#f3f4f6;}
    .alert{padding:12px;border-radius:12px;margin-bottom:8px;font-weight:500;}
    .alert-warning{background:#fff4e5;border:1px solid #fbbf24;color:#92400e;}
    button.logout-btn{padding:8px 14px;border:none;border-radius:10px;font-weight:600;cursor:pointer;background:rgba(255,255,255,0.2);color:white;transition:0.2s;}
    button.logout-btn:hover{background:rgba(255,255,255,0.3);}
    footer{text-align:center;color:var(--muted);padding:32px 0;font-size:14px;margin-top:40px;}
    select#city-dropdown {
      padding: 8px 12px;
      border-radius: 8px;
      border: 1px solid #e5e7eb;
      background: white;
      font-size: 16px;
      margin-bottom: 16px;
      width: 200px;
    }
    @media(max-width:800px){
      .grid-2{grid-template-columns:1fr;}
      #map{height:300px;}
      header, nav.dashboard-nav{flex-direction:column;gap:12px;text-align:center;}
    }
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <div class="logo-placeholder">CN</div>
      <div>
        <h1 style="color:white; background:none; -webkit-text-fill-color:unset;">Health Official’s Dashboard</h1>
        <p style="font-size:13px;opacity:0.9;">Monitoring public health metrics</p>
      </div>
    </div>
    <button class="logout-btn" onclick="window.location.href='signin.html'">Logout</button>
  </header>

  <nav class="dashboard-nav">
    <a href="home.html">Home</a>
    <a href="#dashboard">Dashboard</a>
    <a href="#reports">Reports Submitted</a>
    <a href="#results">Water Quality Results</a>
    <a href="#alerts">Alerts</a>
  </nav>

  <main>
    <p class="sub">Real-time insights into public health and water quality metrics.</p>
    <div>
      <select id="city-dropdown" onchange="updateDashboard()">
        <option value="" disabled selected>Select a City</option>
        <option value="Hyderabad">Hyderabad</option>
        <option value="Assam">Assam</option>
        <option value="Meghalaya">Meghalaya</option>
        <option value="Manipur">Manipur</option>
        <option value="Tripura">Tripura</option>
      </select>
    </div>
    
    <!-- First row -->
    <div class="grid-2">
      <div class="card">
        <h3>Heatmap – Selected City</h3>
        <div id="map"></div>
      </div>
      <div class="card">
        <h3>Cases Graph</h3>
        <canvas id="casesChart"></canvas>
      </div>
    </div>

    <!-- Extra 2 cards -->
    <div class="grid-2">
      <div class="card">
        <h3>Heatmap (Surveillance)</h3>
        <div id="heatmap-chart"></div>
      </div>
      <div class="card">
        <h3>Cases Over Time (Surveillance)</h3>
        <div id="cases-surveillance-chart"></div>
      </div>
    </div>

    <!-- Second row -->
    <div class="grid-2">
      <div class="card">
        <h3>Village Locations & Cases</h3>
        <table id="villageTable">
          <tr><th>State/City</th><th>Cases</th><th>Water Pollution</th></tr>
        </table>
      </div>
      <div class="card">
        <h3>Notifications & Alerts</h3>
        <div id="alerts"></div>
      </div>
    </div>
  </main>

  <footer>
    © 2025 CleanWater. All rights reserved.
  </footer>

  <script>
    let map, chart;

    // Initialize map
    function initMap() {
      map = L.map('map').setView([17.3850, 78.4867], 10);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap contributors'
      }).addTo(map);
    }

    // Initialize bar chart
    function initChart() {
      const ctx = document.getElementById('casesChart').getContext('2d');
      chart = new Chart(ctx, {
        type: 'bar',
        data: { labels: [], datasets: [{ label: 'Number of Cases', data: [] }] },
        options: { responsive: true, scales: { y: { beginAtZero: true } } }
      });
    }

    // --- ApexCharts charts ---
    function initSurveillanceCharts() {
      var casesOptions = {
        chart: { type: 'line', height: 300, toolbar: { show: false } },
        series: [{ name: 'Cases', data: [31, 40, 28, 51, 42, 109, 100, 115, 120, 145] }],
        xaxis: { categories: ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct'] },
        stroke: { curve: 'smooth', width: 3 },
        colors: ['#4f46e5']
      };
      var casesChart = new ApexCharts(document.querySelector("#cases-surveillance-chart"), casesOptions);
      casesChart.render();

      function generateHeatmapData(count, yrange) {
        var i = 0, series = [];
        while (i < count) {
          var x = 'W' + (i + 1).toString();
          var y = Math.floor(Math.random() * (yrange.max - yrange.min + 1)) + yrange.min;
          series.push({ x: x, y: y });
          i++;
        }
        return series;
      }
      var heatmapOptions = {
        chart: { type: 'heatmap', height: 300, toolbar: { show: false } },
        series: [
          { name: 'Zone A', data: generateHeatmapData(8, { min: 0, max: 90 }) },
          { name: 'Zone B', data: generateHeatmapData(8, { min: 0, max: 90 }) }
        ]
      };
      var heatmapChart = new ApexCharts(document.querySelector("#heatmap-chart"), heatmapOptions);
      heatmapChart.render();
    }

    // Update dashboard
    async function updateDashboard() {
      const city = document.getElementById('city-dropdown').value;
      if (!city) return;

      if (map) map.remove();
      if (chart) chart.destroy();
      document.getElementById('villageTable').innerHTML = '<tr><th>State/City</th><th>Cases</th><th>Water Pollution</th></tr>';
      document.getElementById('alerts').innerHTML = '';

      initMap();
      initChart();
      initSurveillanceCharts();

      try {
        const response = await fetch(`http://localhost:5000/submit-report?city=${city}`);
        const result = await response.json();

        if (result.status === 'success' && result.data) {
          const { cases, water_pollution, alerts, coordinates } = result.data;
          const heatPoints = coordinates.map(coord => [coord[0], coord[1], cases]);
          L.heatLayer(heatPoints, { radius: 40, blur: 25 }).addTo(map);

          chart.data.labels = [city];
          chart.data.datasets[0].data = [cases];
          chart.update();

          const table = document.getElementById('villageTable');
          const row = table.insertRow();
          row.insertCell(0).textContent = city;
          row.insertCell(1).textContent = cases;
          row.insertCell(2).textContent = water_pollution;

          const alertsDiv = document.getElementById('alerts');
          alerts.forEach(alert => {
            const alertDiv = document.createElement('div');
            alertDiv.className = 'alert alert-warning';
            alertDiv.textContent = `⚠️ ${alert}`;
            alertsDiv.appendChild(alertDiv);
          });
        }
      } catch (error) {
        console.error('Error fetching data:', error);
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      initMap();
      initChart();
      initSurveillanceCharts();
    });
  </script>
</body>
</html>
